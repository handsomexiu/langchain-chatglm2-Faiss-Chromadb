# 1

åœ¨[ChatGLM2-6B/web_demo.py at main Â· THUDM/ChatGLM2-6B (github.com)](https://github.com/THUDM/ChatGLM2-6B/blob/main/web_demo.py)ä¸­çš„chatglmè°ƒç”¨ä»£ç ä¸­

```python
def predict(input, chatbot, max_length, top_p, temperature, history, past_key_values):
    chatbot.append((parse_text(input), ""))
    for response, history, past_key_values in model.stream_chat(tokenizer, input, history, past_key_values=past_key_values,
                                                                return_past_key_values=True,
                                                                max_length=max_length, top_p=top_p,
                                                                temperature=temperature):
        chatbot[-1] = (parse_text(input), parse_text(response))
        yield chatbot, history, past_key_values
```

- æ¨¡å‹ä½¿ç”¨ï¼šmodel.stream_chat()
- å‚æ•°ï¼špast_key_values
  - åœ¨ç”Ÿæˆä»»åŠ¡ä¸­ï¼Œæ¨¡å‹ä¼šé€ä¸ªç”Ÿæˆæ–°çš„å•è¯ã€‚æ¯ç”Ÿæˆä¸€ä¸ªæ–°å•è¯ï¼Œæ¨¡å‹å°±éœ€è¦å¤„ç†åŒ…å«æ–°å•è¯çš„åºåˆ—ã€‚é€šè¿‡ä½¿ç”¨ past_key_valueï¼Œæˆ‘ä»¬å¯ä»¥é¿å…åœ¨æ¯ä¸ª è®¡ç®—æ•´ä¸ªåºåˆ—çš„é”®å’Œå€¼ï¼Œè€Œåªéœ€åœ¨å‰ä¸€æ—¶é—´æ­¥çš„åŸºç¡€ä¸Šè®¡ç®—æ–°å•è¯çš„é”®å’Œå€¼ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥èŠ‚çœè®¡ç®—èµ„æºï¼Œä»è€ŒåŠ é€Ÿç”Ÿæˆè¿‡ç¨‹ã€‚

# 2 chromadb

[Chroma | ğŸ¦œï¸ğŸ”— Langchain](https://python.langchain.com/docs/integrations/vectorstores/chroma)

```python
# save to disk
db2 = Chroma.from_documents(docs, embedding_function, persist_directory="./chroma_db")
#è¿™é‡Œæ˜¯åˆ›å»ºchromadbå‘é‡æ•°æ®åº“ï¼Œå¦‚æœæœ‰persist_directoryè¿™é‡Œä¼šè‡ªåŠ¨åˆ›å»ºæ–‡ä»¶ï¼Œå…¶ä¸­chroma_dbæ˜¯æ–‡ä»¶å¤¹
docs = db2.similarity_search(query)


# load from disk
db3 = Chroma(persist_directory="./chroma_db", embedding_function=embedding_function)
#è¿™é‡Œæ˜¯åŠ è½½å‘é‡æ•°æ®åº“
docs = db3.similarity_search(query)
print(docs[0].page_content)
```





[langchain.vectorstores.chroma.Chroma â€” ğŸ¦œğŸ”— LangChain 0.0.334](https://api.python.langchain.com/en/latest/vectorstores/langchain.vectorstores.chroma.Chroma.html)

as_retriever(**kwargs: Any) â†’ VectorStoreRetriever

Return VectorStoreRetriever initialized from this VectorStore.

Parameters

- **search_type** (Optional[str]) â€“ Defines the type of search that the Retriever should perform. Can be â€œsimilarityâ€ (default), â€œmmrâ€, or â€œsimilarity_score_thresholdâ€.`str:å­—ç¬¦ä¸²`

- **search_kwargs** (Optional[Dict]) â€“Keyword arguments to pass to the search function. Can include things like:` dictï¼šè¿™æ˜¯ä¸€ä¸ªå­—å…¸`

  - k: Amount of documents to return (Default: 4) score_threshold: Minimum relevance threshold for similarity_score_threshold

  - fetch_k: Amount of documents to pass to MMR algorithm (Default: 20) lambda_mult: Diversity of results returned by MMR;

  - 1 for minimum diversity and 0 for maximum. (Default: 0.5)

  - filter: Filter by document metadata

Returns

- Retriever class for VectorStore.

Return type

- VectorStoreRetriever

